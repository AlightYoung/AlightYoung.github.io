(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{507:function(e,t,s){"use strict";s.r(t);var l=s(2),r=Object(l.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"起因"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#起因"}},[e._v("#")]),e._v(" 起因")]),e._v(" "),t("p",[e._v("因为平时的主力系统还是在使用 Windows，也没有特别强烈的需求非得使用 Linux，所以使用默认的 Windows Powershell 5 似乎是一件顺理成章的事情，然而在一次 VSCode 的 Terminal Shell Integration 的功能中，突然发现 Windows Powershell 5 居然不支持，于是便有了迁移的想法。")]),e._v(" "),t("p",[e._v("然而事实上根本不需要迁移，因为 Powershell 7 与 Windows Powershell 5 是共存的，不过还是打算写下这篇日志用于记录切换到 Powerhsell 7 的过程。")]),e._v(" "),t("h2",{attrs:{id:"powershell-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#powershell-7"}},[e._v("#")]),e._v(" Powershell 7")]),e._v(" "),t("p",[e._v("Powershell 7 与 Windows Poershell 5 最大的区别是 Powershell 7 是全平台支持，并且被宣称为专门为云环境设计，这让很多使用 Windows Powershell 的人可以在远程 Linux 时也能使用自己熟悉的 Shell 环境。（虽然大部分人可能还是会选择 ZSH 吧），不过这种支持确实能给用户很大的诱惑力。")]),e._v(" "),t("p",[e._v("关于 Powershell 7 的特性，这里就不赘述了，直接引用官方原话吧。")]),e._v(" "),t("div",{staticClass:"custom-block theorem"},[t("p",{staticClass:"title"},[e._v("Powershell 7 Features")]),t("p",[e._v("Designed for cloud, on-premises, and hybrid environments, PowerShell 7 is packed with enhancements and new features.")]),e._v(" "),t("ul",[t("li",[e._v("Installs and runs side-by-side with Windows PowerShell")]),e._v(" "),t("li",[e._v("Improved compatibility with existing Windows PowerShell modules")]),e._v(" "),t("li",[e._v("New language features, like ternary operators and ForEach-Object -Parallel")]),e._v(" "),t("li",[e._v("Improved performance")]),e._v(" "),t("li",[e._v("SSH-based remoting")]),e._v(" "),t("li",[e._v("Cross-platform interoperability")]),e._v(" "),t("li",[e._v("Support for Docker containers")])]),e._v(" "),t("div",{staticClass:"custom-block right"},[t("p",[e._v("来自 "),t("a",{attrs:{href:"https://learn.microsoft.com/en-us/powershell/scripting/whats-new/migrating-from-windows-powershell-51-to-powershell-7?view=powershell-7.2",target:"_blank",rel:"noopener noreferrer"}},[e._v("Migrating from Windows PowerShell 5.1 to PowerShell 7"),t("OutboundLink")],1)])])]),t("h2",{attrs:{id:"迁移"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#迁移"}},[e._v("#")]),e._v(" 迁移")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("安装 Powershell 7，"),t("a",{attrs:{href:"https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-windows?view=powershell-7.2",target:"_blank",rel:"noopener noreferrer"}},[e._v("Windows 传送门"),t("OutboundLink")],1),e._v(" ，其他系统例如 Linux，macOS，Arm，Docker 可直接在侧栏切换即可。")])]),e._v(" "),t("li",[t("p",[e._v("Windows Terminal 配置，会自动添加配置项，只需要切换默认配置文件为 Powershell 7 即可。")])]),e._v(" "),t("li",[t("p",[e._v("默认的安装位置：")])])]),e._v(" "),t("ul",[t("li",[e._v("Windows PowerShell 5.1: "),t("code",[e._v("$env:WINDIR\\System32\\WindowsPowerShell\\v1.0")])]),e._v(" "),t("li",[e._v("PowerShell 6.x: "),t("code",[e._v("$env:ProgramFiles\\PowerShell\\6")])]),e._v(" "),t("li",[e._v("PowerShell 7: "),t("code",[e._v("$env:ProgramFiles\\PowerShell\\7")])])]),e._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[e._v("Powershell 模块路径与 Windows Powershell 是隔离的，但是 Powershell 的默认模块路径时包括 Windows Powershell 的模块路径的，且这些模块大概率是兼容 Powershell 7 的，这意味着你不用重新下载模块，只需要拷贝一份原来的配置文件即可。想查看具体路径可以使用命令："),t("code",[e._v("$Env:PSModulePath -split (';')")]),e._v("。以下是不同范围的模块路径说明。")])]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[e._v("Install Scope")]),e._v(" "),t("th",{staticStyle:{"text-align":"left"}},[e._v("Windows PowerShell 5.1")]),e._v(" "),t("th",{staticStyle:{"text-align":"left"}},[e._v("PowerShell 7.0")])])]),e._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[e._v("PowerShell modules")]),e._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[e._v("$env:WINDIR\\system32\\WindowsPowerShell\\v1.0\\Modules")])]),e._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[e._v("$PSHOME\\Modules")])])]),e._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[e._v("User installed AllUsers scope")]),e._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[e._v("$env:ProgramFiles\\WindowsPowerShell\\Modules")])]),e._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[e._v("$env:ProgramFiles\\PowerShell\\Modules")])])]),e._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[e._v("User installed CurrentUser scope")]),e._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[e._v("$HOME\\Documents\\WindowsPowerShell\\Modules")])]),e._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[e._v("$HOME\\Documents\\PowerShell\\Modules")])])])])]),e._v(" "),t("ol",{attrs:{start:"5"}},[t("li",[e._v("复制一份原来的配置文件到新的路径，文件不存在则新建。Windows Powershell 的路径是 "),t("code",[e._v("$HOME\\Documents\\WindowsPowerShell")]),e._v("，而 Powershell 的路径为 "),t("code",[e._v("$HOME\\Documents\\PowerShell")]),e._v(". 除了用户级别的配置文件之外，还有全局的配置文件，且配置文件的名字也发生了变化，具体参考以下命令输出结果。")])]),e._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("PS")]),e._v("> "),t("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$PROFILE")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("Select-Object")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("Host* "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("Format-List")]),e._v("\n\nAllUsersAllHosts       : C:\\Program Files\\PowerShell\\7\\profile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("ps1\nAllUsersCurrentHost    : C:\\Program Files\\PowerShell\\7\\Microsoft"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("PowerShell_profile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("ps1\nCurrentUserAllHosts    : C:\\Users\\<user>\\Documents\\PowerShell\\profile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("ps1\nCurrentUserCurrentHost : C:\\Users\\<user>\\Documents\\PowerShell\\Microsoft"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("PowerShell_profile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("ps1\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br")])]),t("p",[e._v("需要了解更多的配置项可以参考 "),t("a",{attrs:{href:"https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_profiles",target:"_blank",rel:"noopener noreferrer"}},[e._v("about_Profiles"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("ol",{attrs:{start:"6"}},[t("li",[e._v("最后再把 VSCode 的终端默认使用 Powershell 7 即可。步骤，打开命令面板 "),t("code",[e._v("Ctrl Shift P")]),e._v("，"),t("code",[e._v("Terminal: Select Default Profile")]),e._v("，然后选择 Powershell 7 的那个配置就行了。随后就可以体验到增强的终端功能了，比如执行命令失败会在命令的左边有个红色断点，成功为蓝色，同时右侧进度条也会有提醒，方便快速定位命令，同时左侧断点可以直接重新执行命令，复制命令输出为基础格式，HTML格式等，更多功能可以查看 "),t("a",{attrs:{href:"https://code.visualstudio.com/docs/terminal/shell-integration",target:"_blank",rel:"noopener noreferrer"}},[e._v("Terminal Shell Integration"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"配置文件备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件备份"}},[e._v("#")]),e._v(" 配置文件备份")]),e._v(" "),t("div",{staticClass:"language-powershell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# oh my posh")]),e._v("\noh-my-posh "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v("init "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v("shell pwsh "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v("config ~"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),e._v("scoop/apps/oh-my-posh/current/themes/zash"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("omp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("json "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("Invoke-Expression")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# posh-git")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("Import-Module")]),e._v(" posh-git\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("h2",{attrs:{id:"结束"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#结束"}},[e._v("#")]),e._v(" 结束")]),e._v(" "),t("p",[e._v("至此，迁移到 Powershell 7 的工作基本结束，想了解 Powershell 的功能，例如远程支持，组策略相关可以查看"),t("a",{attrs:{href:"https://learn.microsoft.com/en-us/powershell/scripting/whats-new/migrating-from-windows-powershell-51-to-powershell-7?view=powershell-7.2",target:"_blank",rel:"noopener noreferrer"}},[e._v("官方文档"),t("OutboundLink")],1),e._v("后半部分。")])])}),[],!1,null,null,null);t.default=r.exports}}]);